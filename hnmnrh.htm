<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ทดสอบดึงชื่อจาก HN</title>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <style>
        body { font-family: sans-serif; padding: 20px; }
        input { font-size: 1.2em; padding: 5px; }
        button { font-size: 1.2em; padding: 5px; }
        #result { margin-top: 20px; }
        #lblFullname { color: blue; font-weight: bold; font-size: 1.5em; }
        .error { color: red; }
    </style>
</head>
<body>

    <h2>ทดสอบดึงชื่อจาก HN (MNRH Lab)</h2>
    
    <div>
        <label for="txtHN">ใส่ HN:</label>
        <input type="text" id="txtHN" placeholder="พิมพ์ HN...">
        <button id="btnSearch">ค้นหา</button>
    </div>

    <div id="result">
        <h3>ชื่อ-นามสกุล: 
            <span id="lblFullname">...รอการค้นหา...</span>
        </h3>
    </div>

    <script>
        // รอให้หน้าเว็บโหลดเสร็จก่อน
        $(document).ready(function() {

            // --- นี่คือฟังก์ชัน getFullName ที่แกะมาจากไฟล์ของคุณ ---
            function getFullName(ahn) {
                
                // *** นี่คือส่วนที่สำคัญที่สุด ***
                // เราต้องระบุ URL เต็มไปยังไฟล์ PHP ที่อยู่บนเซิร์ฟเวอร์
                var scriptUrl = "http://192.168.41.110/labmnrhs/sql/getFullname.php";

                // แจ้งผู้ใช้ว่ากำลังโหลด
                $("#lblFullname").text("กำลังค้นหา...").removeClass("error");

                // ใช้ $.post (AJAX) เพื่อส่งคำขอไปที่เซิร์ฟเวอร์
                $.post(scriptUrl, {
                    ahn: ahn // ส่งค่า 'ahn' ที่เราได้มา
                }, function(result) {
                    // --- เมื่อเซิร์ฟเวอร์ตอบกลับมา (success) ---
                    try {
                        // แปลงข้อความที่ได้กลับมา (JSON) ให้เป็น Object
                        var obj = jQuery.parseJSON(result);
                        var aFullname = [];

                        if (obj && obj.length > 0) {
                            // ดึงชื่อจากข้อมูลที่ได้
                            for (var i in obj) {
                                aFullname.push(obj[i].ptName);
                            }
                            // แสดงชื่อในช่อง lblFullname
                            $("#lblFullname").text(aFullname[0]);
                        } else {
                            // ถ้าค้นหาแต่ไม่เจอข้อมูล
                            $("#lblFullname").text("--- ไม่พบข้อมูล HN นี้ ---").addClass("error");
                        }
                    } catch (e) {
                        // ถ้าไฟล์ PHP ส่งค่ากลับมาผิดพลาด (ไม่ใช่ JSON)
                        $("#lblFullname").text("เกิดข้อผิดพลาด: ไม่สามารถอ่านข้อมูลได้").addClass("error");
                        console.error("Error parsing JSON:", result);
                    }
                })
                .fail(function() {
                    // --- หากการเชื่อมต่อล้มเหลว (fail) ---
                    // เช่น พิมพ์ URL ผิด, เซิร์ฟเวอร์ปิด, หรือไม่ได้อยู่ในเครือข่าย
                    $("#lblFullname").text("--- เชื่อมต่อเซิร์ฟเวอร์ไม่ได้ ---").addClass("error");
                    alert("ไม่สามารถติดต่อเซิร์ฟเวอร์ที่: " + scriptUrl + "\nโปรดตรวจสอบว่าคุณเชื่อมต่อเครือข่าย 192.168.41.xx ถูกต้อง");
                });
            };
            // --- จบฟังก์ชัน getFullName ---


            // --- ตัวดักจับเหตุการณ์ (Triggers) ---

            // 1. เมื่อคลิกปุ่ม "ค้นหา"
            $("#btnSearch").click(function() {
                var ahn_input = $("#txtHN").val(); // ดึงค่า HN จากช่อง input
                if (ahn_input) { // ตรวจสอบว่าไม่เป็นค่าว่าง
                    getFullName(ahn_input); // เรียกฟังก์ชันเพื่อเริ่มค้นหา
                } else {
                    $("#lblFullname").text("...รอการค้นหา...").removeClass("error");
                }
            });

            // 2. เมื่อกด "Enter" ในช่อง input
            $('#txtHN').on("keypress", function(e) {
                if (e.keyCode == 13) { // 13 คือรหัสปุ่ม Enter
                    // สั่งให้ปุ่ม "ค้นหา" ถูกคลิก
                    $("#btnSearch").click();
                }
            });

        });
    </script>

</body>
</html>
